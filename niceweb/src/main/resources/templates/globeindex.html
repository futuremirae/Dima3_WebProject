<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>세계 지도</title>
    <style>
        #btnContainer {
            display: flex; /* Flexbox를 활용해 가로 정렬 */
            /*justify-content: space-between; /* 버튼들 사이에 균등하게 공간 배분 */
            align-items: center; /* 세로 중앙 정렬 */
        }

        .statBtn {
            display: flex; /* Flexbox를 활용해 요소 내부 컨텐츠 중앙 정렬 */
            width: 75px;
            height: 45px;

            font-size: 1.05em;
            font-weight: bold;

            text-align: center;
            align-items: center;
            justify-content: center;

            border: 2px solid black;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }

        .statBtn:hover {
            background: darkblue;
            color: white;
        }


        #chartdiv {
            width: 70%;
            height: 800px;
            max-width: 100%;
        }

        select {
            width: 200px;
            height: 25px;
            margin-top: 25px;
            margin-right: 60px;
        }

        .dropdown-container {
            position: absolute;
            top: 0;
            right: 0;
        }

        #countryInfo {
            display: none;
            position: absolute;
            top: 100px;
            right: 50px;
            padding: 15px;
            background-color: rgb(255, 255, 255);
            width: 450px;
            height: auto;
            border: 1px solid #ccc;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
        }

        .flag-container {
            display: flex;
            align-items: center;
        }

        #countryFlag {
            width: 100px;
            height: 60px;
            margin-right: 20px;
        }

        #countryName {
            font-size: 32px;
        }

        #insertChart {
            width: 450px;
            height: 300px;
        }
    </style>
</head>
<body>
    <div class="dropdown-container">
        <select id="continentSelect" onchange="updateCountryList()">
            <option value="">Select Continent</option>
            <option value="Asia">Asia</option>
            <option value="Europe">Europe</option>
            <option value="NorthAmerica">North America</option>
            <option value="SouthAmerica">South America</option>
            <option value="Africa">Africa</option>
            <option value="Oceania">Oceania</option>
        </select>

        <select id="countrySelect">
            <option value="">Select Country</option>
        </select>
    </div>
    <div id="chartdiv"></div>
    <div id="countryInfo">
        <div class="flag-container">
            <img id="countryFlag" src="" alt="Flag">
            <div>
                <h3 id="countryName">국가를 선택하세요</h3>
            </div>
        </div>
        <hr>
        <div id="countryDetails">
            국가 정보가 여기에 표시됩니다.
        </div>
        <br><br>
        <br><br>
        <div id="btnContainer">
            <div id="expBtn" class="statBtn">
                <p>수입</p>
            </div>
            <div id="impBtn" class="statBtn">
                <p>수출</p>
            </div>
            <div id="balBtn" class="statBtn">
                <p>무역<br>수지</p>
            </div>
            <div id="gwtBtn" class="statBtn">
                <p>경제<br>성장률</p>
            </div>
            <div id="gdpBtn" class="statBtn">
                <p>GDP</p>
            </div>
            <div id="regBtn" class="statBtn">
                <p>규제</p>
            </div>
        </div>
        <div id="staticArea">
            <div id="insertChart"></div>
        </div>
        
    </div>

    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script>
        am5.ready(function () {

            // Create root element
            // https://www.amcharts.com/docs/v5/getting-started/#Root_element
            var root = am5.Root.new("chartdiv");
        
        
            // Set themes
            // https://www.amcharts.com/docs/v5/concepts/themes/
            root.setThemes([
                am5themes_Animated.new(root)
            ]);
        
        
            // Create the map chart
            // https://www.amcharts.com/docs/v5/charts/map-chart/
            var chart = root.container.children.push(am5map.MapChart.new(root, {
                panX: "rotateX",
                panY: "rotateY",
                projection: am5map.geoOrthographic(),
                paddingBottom: 20,
                paddingTop: 20,
                paddingLeft: 20,
                paddingRight: 20
            }));
            var filter = root.interfaceColors.get("shadow");
            chart.set("filter", filter);
        
            var backgroundSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {}));
            backgroundSeries.mapPolygons.template.setAll({
                fill: am5.color(0x6AE4),
                fillOpacity: 0.9,
                strokeOpacity: 0
            });
            backgroundSeries.data.push({
                geometry: am5map.getGeoRectangle(90, 180, -90, -180)
            });
        
        
            // Create main polygon series for countries
            // https://www.amcharts.com/docs/v5/charts/map-chart/map-polygon-series/
            var polygonSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {
                geoJSON: am5geodata_worldLow
            }));
        
            polygonSeries.mapPolygons.template.setAll({
                tooltipText: "{name}",
                toggleKey: "active",
                interactive: true,
                fill: am5.color(0x33CC33),
                strokeWidth: 1
            });
        
            polygonSeries.mapPolygons.template.states.create("hover", {
                fill: am5.color(0x009900) // Darker green when hovered
            });
        
            polygonSeries.mapPolygons.template.states.create("active", {
                fill: am5.color(0x006600) // Even darker green when clicked
            });
        
        
            // Create series for background fill
            // https://www.amcharts.com/docs/v5/charts/map-chart/map-polygon-series/#Background_polygon
        
            var graticuleSeries = chart.series.unshift(
                am5map.GraticuleSeries.new(root, {
                    step: 10
                })
            );
        
            graticuleSeries.mapLines.template.set("strokeOpacity", 0.1)
        
            // Set up events
            var previousPolygon;
        
            polygonSeries.mapPolygons.template.on("active", function (active, target) {
                if (previousPolygon && previousPolygon != target) {
                    previousPolygon.set("active", false);
                }
                if (target.get("active")) {
                    selectCountry(target.dataItem.get("id"));
                }
                previousPolygon = target;
            });
            const countryNames = {
                "CN": "China", "KR": "South Korea", "IN": "India", "MY": "Malaysia", "JP": "Japan", "TH": "Thailand", "HK": "Hong Kong", "SG": "Singapore", "TW": "Taiwan",
                "AE": "United Arab Emirates", "IL": "Israel", "BH": "Bahrain", "QA": "Qatar", "VN": "Vietnam", "SA": "Saudi Arabia", "ID": "Indonesia", "PH": "Philippines", "PK": "Pakistan",
                "LK": "Sri Lanka", "UZ": "Uzbekistan", "DE": "Germany", "GB": "United Kingdom", "FR": "France", "SE": "Sweden", "AT": "Austria", "DK": "Denmark",
                "IT": "Italy", "BE": "Belgium", "NL": "Netherlands", "SI": "Slovenia", "HU": "Hungary", "CH": "Switzerland", "CZ": "Czech Republic", "RO": "Romania",
                "TR": "Turkey", "RS": "Serbia", "PL": "Poland", "UA": "Ukraine", "SK": "Slovakia", "FI": "Finland", "BG": "Bulgaria", "EE": "Estonia", "GR": "Greece",
                "NO": "Norway", "PT": "Portugal", "LV": "Latvia", "HR": "Croatia", "GE": "Georgia", "BY": "Belarus", "LT": "Lithuania", "MT": "Malta",
                "BA": "Bosnia and Herzegovina", "ES": "Spain", "US": "United States", "CA": "Canada", "MX": "Mexico", "GT": "Guatemala", "CR": "Costa Rica", "SV": "El Salvador",
                "JM": "Jamaica", "NI": "Nicaragua", "DO": "Dominican Republic", "VG": "British Virgin Islands", "PA": "Panama", "BR": "Brazil", "CO": "Colombia", "AR": "Argentina",
                "CL": "Chile", "VE": "Venezuela", "EC": "Ecuador", "TT": "Trinidad and Tobago", "ZA": "South Africa", "NG": "Nigeria", "EG": "Egypt", "MA": "Morocco", "KE": "Kenya",
                "NZ": "New Zealand", "AU": "Australia"
            };
            function getCountryName(code) {
                return countryNames[code] || code;  // 국가 코드에 해당하는 이름이 없다면 코드를 그대로 반환
            }
        
            function generateCountryList(continent) {
                var ul = document.createElement('ul');
                continentCountries[continent].forEach(function (countryCode) {
                    var li = document.createElement('li');
                    var a = document.createElement('a');
                    a.href = "#";
                    a.textContent = getCountryName(countryCode);  // 국가 코드를 국가명으로 변환
                    a.addEventListener('click', function (event) {
                        event.preventDefault();
                        selectCountry(countryCode);
                    });
                    li.appendChild(a);
                    ul.appendChild(li);
                });
                return ul;
            }
            // 기존의 국가 코드 목록을 하나로 통합합니다.
            // 모든 국가 코드 목록을 하나로 통합합니다.
            var allContinentCountries = [].concat.apply([], Object.values(continentCountries));
        
            // geoJSON 데이터가 시리즈에 로드된 후에 각 국가 폴리곤에 대한 설정을 합니다.
            polygonSeries.events.on("datavalidated", function () {
                // 모든 데이터 항목들을 반복하면서 조건에 맞지 않는 국가들의 색상을 변경합니다.
                polygonSeries.mapPolygons.each(function (mapPolygon) {
                    var countryId = mapPolygon.dataItem.dataContext.id;
                    if (!allContinentCountries.includes(countryId)) {
                        // continentCountries에 포함되지 않는 국가의 색상을 변경합니다.
                        mapPolygon.set("fill", am5.color(0xAAAAAA)); // 색상 코드를 변경하세요.
                    }
                });
            });
            polygonSeries.events.on("datavalidated", function () {
                polygonSeries.mapPolygons.each(function (mapPolygon) {
                    var countryId = mapPolygon.dataItem.dataContext.id;
                    if (!allContinentCountries.includes(countryId)) {
                        // continentCountries에 포함되지 않는 국가의 색상을 변경합니다.
                        mapPolygon.set("fill", am5.color(0xCCCCCC)); // 변경하고자 하는 색상 코드로 설정하세요.
        
                        // 클릭을 비활성화합니다.
                        mapPolygon.set("interactive", false);
                    }
                });
            });
        
            function updateTooltip(target, dataItem) {
                var countryName = countryNames[dataItem.dataContext.id] || dataItem.dataContext.name;
                if (target.tooltip) {
                    target.tooltip.text = countryName;
                } else {
                    target.tooltip = am5.Tooltip.new(root, {
                        text: countryName
                    });
                }
                target.showTooltip();
            }
        
            function getCountryName(code) {
                return countryNames[code] || code;
            }
        
            var lastActiveTooltip = null; // Last active tooltip
        
            function selectCountry(id) {
                // 툴팁이 이미 활성화되어 있다면 숨깁니다.
                if (lastActiveTooltip) {
                    lastActiveTooltip.hideTooltip();
                }
        
                // 선택된 국가의 데이터 항목을 가져옵니다.
                var dataItem = polygonSeries.getDataItemById(id);
                var target = dataItem.get("mapPolygon");
        
                // 대상 폴리곤이 존재한다면 실행합니다.
                if (target) {
                    // 대상 국가의 지리적 중심으로 지도를 이동시킵니다.
                    moveToCountry(target.geoCentroid().longitude, target.geoCentroid().latitude);
        
                    // 국가 정보를 업데이트합니다.
                    updateCountryInfo(id);
        
                    // 대상 폴리곤의 툴팁을 업데이트하고 활성화 상태로 설정합니다.
                    updateTooltip(target, dataItem);
                    target.set("active", true);
        
                    // 마지막으로 활성화된 툴팁을 업데이트합니다.
                    lastActiveTooltip = target;
                }
            }
        
            function moveToCountry(longitude, latitude) {
                chart.animate({ key: "rotationX", to: -longitude, duration: 1500 });
                chart.animate({ key: "rotationY", to: -latitude, duration: 1500 });
            }
        
            function updateCountryInfo(countryCode) {
                var countryName = getCountryName(countryCode); // 국가 이름 가져오기
                var flagUrl = `https://flagsapi.com/${countryCode}/flat/64.png`; // 국기 이미지 URL 생성
        
                document.getElementById('countryFlag').src = flagUrl; // 이미지 소스 업데이트
                document.getElementById('countryFlag').alt = "Flag of " + countryName; // 대체 텍스트 설정
                document.getElementById('countryName').textContent = countryName; // 국가 이름 업데이트
                document.getElementById('countryDetails').textContent = "Details about " + countryName; // 세부 정보 업데이트
                document.getElementById('countryInfo').style.display = 'block'; // 정보 박스 표시
                // 이미지 세로 길이 조정
                document.getElementById('countryFlag').style.height = '100px'; // 예시로 100px로 조정
        
            }
        
            document.getElementById('countrySelect').addEventListener('change', function () {
                var selectedCountryId = this.value;
                selectCountry(selectedCountryId);
            });
        
            document.getElementById('continentSelect').addEventListener('change', function () {
                updateCountryList();
            });
        
            function updateCountryList() {
                var continent = document.getElementById("continentSelect").value;
                var countrySelect = document.getElementById("countrySelect");
                countrySelect.innerHTML = '<option value="">Select Country</option>';
                if (continent) {
                    continentCountries[continent].forEach(function (code) {
                        var option = document.createElement("option");
                        option.value = code;
                        option.textContent = getCountryName(code);
                        countrySelect.appendChild(option);
                    });
                }
            }
        });
        
        const continentCountries = {
            "Asia": ["CN", "KR", "IN", "MY", "JP", "TH", "HK", "SG", "TW", "AE", "IL", "BH", "QA", "VN", "SA", "ID", "PH", "PK", "LK", "UZ"],
            "Europe": ["DE", "GB", "FR", "SE", "AT", "DK", "IT", "BE", "NL", "SI", "HU", "CH", "CZ", "RO", "TR", "RS", "PL", "UA", "SK", "FI", "BG", "EE", "GR", "NO", "PT", "LV", "HR", "GE", "BY", "LT", "MT", "BA", "ES"],
            "NorthAmerica": ["US", "CA", "MX", "GT", "CR", "SV", "JM", "NI", "DO", "VG", "PA"],
            "SouthAmerica": ["BR", "CO", "AR", "CL", "VE", "EC", "TT"],
            "Africa": ["ZA", "NG", "EG", "MA", "KE"],
            "Oceania": ["NZ", "AU"]
        };
        
        const countryNames = {
            "CN": "China", "KR": "South Korea", "IN": "India", "MY": "Malaysia", "JP": "Japan", "TH": "Thailand", "HK": "Hong Kong", "SG": "Singapore", "TW": "Taiwan",
            "AE": "United Arab Emirates", "IL": "Israel", "BH": "Bahrain", "QA": "Qatar", "VN": "Vietnam", "SA": "Saudi Arabia", "ID": "Indonesia", "PH": "Philippines", "PK": "Pakistan",
            "LK": "Sri Lanka", "UZ": "Uzbekistan", "DE": "Germany", "GB": "United Kingdom", "FR": "France", "SE": "Sweden", "AT": "Austria", "DK": "Denmark",
            "IT": "Italy", "BE": "Belgium", "NL": "Netherlands", "SI": "Slovenia", "HU": "Hungary", "CH": "Switzerland", "CZ": "Czech Republic", "RO": "Romania",
            "TR": "Turkey", "RS": "Serbia", "PL": "Poland", "UA": "Ukraine", "SK": "Slovakia", "FI": "Finland", "BG": "Bulgaria", "EE": "Estonia", "GR": "Greece",
            "NO": "Norway", "PT": "Portugal", "LV": "Latvia", "HR": "Croatia", "GE": "Georgia", "BY": "Belarus", "LT": "Lithuania", "MT": "Malta",
            "BA": "Bosnia and Herzegovina", "ES": "Spain", "US": "United States", "CA": "Canada", "MX": "Mexico", "GT": "Guatemala", "CR": "Costa Rica", "SV": "El Salvador",
            "JM": "Jamaica", "NI": "Nicaragua", "DO": "Dominican Republic", "VG": "British Virgin Islands", "PA": "Panama", "BR": "Brazil", "CO": "Colombia", "AR": "Argentina",
            "CL": "Chile", "VE": "Venezuela", "EC": "Ecuador", "TT": "Trinidad and Tobago", "ZA": "South Africa", "NG": "Nigeria", "EG": "Egypt", "MA": "Morocco", "KE": "Kenya",
            "NZ": "New Zealand", "AU": "Australia"
        };        
    </script>
    <script>
        // statBtn클래스를 가지는 div태그 설정
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.statBtn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    // 다른 모든 statBtn 요소에 대한 스타일을 초기화
                    document.querySelectorAll('.statBtn').forEach(function(otherBtn) {
                        otherBtn.style.borderBottom = ''; // 초기 스타일로 재설정
                    });
    
                    // 클릭된 요소의 스타일을 변경
                    btn.style.borderBottom = 'none';
                });

                //
            });
        });
    </script>
    <script>
        // 통계 차트!!!
        am5.ready(function() {

            // 차트 생성
            // https://www.amcharts.com/docs/v5/getting-started/#Root_element
            var root = am5.Root.new("insertChart");


            // 차트 테마 설정
            // https://www.amcharts.com/docs/v5/concepts/themes/
            root.setThemes([
                am5themes_Animated.new(root)
            ]);

            // 데이터 설정
            // 각 국가에 맞는 데이터들을 꽂아넣기
            var data = {
            "US" : [
                    {date: new Date(2019, 5, 3).getTime(), value: 50000}
                    , {date: new Date(2020, 5, 3).getTime(), value: 52000}
                    , {date: new Date(2021, 5, 3).getTime(), value: 48000}
                    , {date: new Date(2022, 5, 3).getTime(), value: 47000}
                    , {date: new Date(2023, 5, 3).getTime(), value: 26999, bullet: true}
            ]
            }

            // 만약 가장 최근값이 null이라면 직전 값에 bullet(빨강 강조표시)값을 추가
            for (let i = 1; i < data.length; i++) {
                if (data[i].value === null) {
                    data[i - 1].bullet = true;
                }
            }



            // xy차트 생성
            // 2차원 차트를 생성하여 스크롤 및 줌 기능 활성화
            // 이동 기능과 줌 기능은 필요없으므로 제거함!
            // https://www.amcharts.com/docs/v5/charts/xy-chart/
            var chart = root.container.children.push(am5xy.XYChart.new(root, {
                panX: true,
                //panY: true,
                //wheelX: "panX",
                //wheelY: "zoomX",
                //pinchZoomX:true,
                paddingLeft: 0
            }));

            chart.get("colors").set("step", 3);



            // 커서 추가
            // https://www.amcharts.com/docs/v5/charts/xy-chart/cursor/
            var cursor = chart.set("cursor", am5xy.XYCursor.new(root, {}));
            cursor.lineY.set("visible", false);


            // X축 값매기기
            // https://www.amcharts.com/docs/v5/charts/xy-chart/axes/
            var xAxis = chart.xAxes.push(am5xy.DateAxis.new(root, {
                maxDeviation: 0.3,
                baseInterval: {
                timeUnit: "year",
                count: 1
            },
                renderer: am5xy.AxisRendererX.new(root, {
                minorGridEnabled: true,
                minGridDistance: 30
                }),
                tooltip: am5.Tooltip.new(root, {})
            }));

            // 데이터 내에서 최대값 찾기(자동 크기조정 목적)
            var maxValue = Math.max(...data.map(item => item.value));
            var minValue = Math.min(...data.map(item => item.value));

            // y축에 값매기기
            var yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
                maxDeviation: 0.3,
                renderer: am5xy.AxisRendererY.new(root, {}),
                min: minValue - (minValue * 0.2),   // 최소 값 설정 - 최소 데이터 크기보다 20% 더 작게
                max: maxValue + (maxValue * 0.2),   // 최대 값 설정 - 최대 데이터 크기보다 20% 더 크게
                strictMinMax: true,                 // min과 max의 값을 한 번 더 강조
                extraMin: 0,                        // 축의 아래쪽 여유 공간 비율 설정 (필요하다면)
                //extraMax: 0.1                       // 축의 위쪽 여유 공간을 10%로 설정 (필요하다면)
            }));
                // 축의 간격(step) 설정
            yAxis.get("renderer").grid.template.setAll({
                location: 0
            });
            yAxis.get("renderer").labels.template.setAll({
                location: 0
            });
            yAxis.set("step", 10000);  // 10,000 단위로 눈금 설정


            // 시리즈 객체 생성
            // https://www.amcharts.com/docs/v5/charts/xy-chart/series/
            var series = chart.series.push(am5xy.LineSeries.new(root, {
                name: "Series 1",
                xAxis: xAxis,
                yAxis: yAxis,
                valueYField: "value",
                valueXField: "date",
                tooltip: am5.Tooltip.new(root, {
                labelText: "{valueY}"
                })
            }));
            series.strokes.template.setAll({
                strokeWidth: 2,
                strokeDasharray: [3, 3]
            });

            // 제일 최신 데이터에 강조 표시 생성
            series.bullets.push(function(root, series, dataItem) {  
            if (dataItem.dataContext.bullet) {    
                var container = am5.Container.new(root, {});
                var circle0 = container.children.push(am5.Circle.new(root, {
                    radius: 5,
                    fill: am5.color(0xff0000)
                }));
                var circle1 = container.children.push(am5.Circle.new(root, {
                    radius: 5,
                    fill: am5.color(0xff0000)
                }));

                circle1.animate({
                    key: "radius",
                    to: 20,
                    duration: 1000,
                    easing: am5.ease.out(am5.ease.cubic),
                    loops: Infinity
                });
                circle1.animate({
                    key: "opacity",
                    to: 0,
                    from: 1,
                    duration: 1000,
                    easing: am5.ease.out(am5.ease.cubic),
                    loops: Infinity
                });

                return am5.Bullet.new(root, {
                    sprite: container
                    })
                }
            });

            series.data.setAll(data);


            // Make stuff animate on load
            // https://www.amcharts.com/docs/v5/concepts/animations/
            series.appear(1000);
            chart.appear(1000, 100);

        }); // end am5.ready()
    </script>
</body>
</html>